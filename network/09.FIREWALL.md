# FILEWALL (방화벽)

방화벽은 미리 정의 정의된 보안 규칙에 기반한, 들어오고 나가는 네트워크 트래픽을 모니터링하고 제어하는 보안 시스템을 말한다.

## 방화벽 기능

- 접근 통제 (패킷 필터링, 프록시)
- 인증
- 검사 및 로그 기능
- 프라이버시 보호
- 서비스 통제
- 데이터 암호화 (주로 vpn 사용)

## 방화벽의 한계점

- 악성 소프트웨어 침투 방어에 대한 한계
  : 일반적으로 방화벽은 패킷의 IP 주소와 포트번호로 접근 제어를 하므로 프로그램 내부에 포함된 악성 소프트웨어를 탐지하는데 한계가 있다.

- 악의적인 내부 사용자의 공격에 대한 한계
  : 내부 사용자가 방화벽을 통과하는 통신 선로가 아닌 셀룰러 망이나 사설 통신 선로를 이용하여 통신을 한다면
    공격자는 방화벽을 우회하여 내부 네트워크로 접속할 수 있는데, 내부자가 이를 아굥하면 막을 방법이 없다.

## 패킷 필터링

방화벽의 기본이 되는 개념은 특정 서버와 해당 서버 안의 특정 애플리케이션에 액세스하는 패킷만 통과시키고
그 외의 패킷은 차단하는 것이다.

네트워크에는 다양한 종류의 패킷이 많이 흐르는데 이 중에서 통과시킬 패킷과 차단할 패킷을 선별하는 것은
간단한 일이 아니기 때문에 지금까지 다양한 방법이 고안되었고
그 중 성능, 가격, 사용 편의성 등의 이유로 패킷 필터링형이 가장 많이 보급되었다.

## 패킷 필터링 조건 설정

패킷의 헤더에는 통신 동작을 제어하는 제어 정보가 들어있다.

### 주소 변환과 패킷 필터링의 조건 설정에 이용하는 항목

#### MAC 헤더

- 송신처 MAC 주소

#### IP 헤더

- 송신처 IP 주소
- 수신처 IP 주소
- 프로토콜 번호

#### TCP / UDP 헤더

- 송신처 포트 번호
- 수신처 포트 번호
- TCP 컨트롤 비트
- 프래그먼트

#### 헤더가 아닌 ICMP 메시지의 내용

- ICMAP 메시지의 유형

## 애플리케이션을 한정할 때 포트 번호 사용

패킷 필터링의 조건을 설정할 때는 먼저 패킷의 흐름을 착안하고, 수신처 IP 주소와 송신처 IP 주소에 따라 시점과 종점을 판단한다.

공개용 서버를 설치하는 LAN과 사내 LAN이 분리 되어 있고 웹 서버는 공개 서버용 LAN에 접속되어 있는 상황으로 봤을 때
인터넷에서 웹 서버를 향해 패킷이 흐르는 것을 허용하기 위해 수신처 IP 주소가 웹 서버이고,
웹 서버는 포트 번호가 80번이기 때문에 포트 번호가 80인 패킷만 통과시킨다.
그 후 수신 확인 응답의 구조가 적용되어야 하기 때문에, 송신처 IP 주소가 웹 서버이고, 포트 번호가 80인 패킷만 통과시킨다.

## 컨트롤 비트로 접속 방향 판단

서버에서 인터넷 측에 액세스 하는 동작을 정지 시키려면, 
패킷이 흐르는 방향이 아니라 액세스 방향을 판단하여 정지시켜야 하는데
여기서 도움이 되는 것이 TCP 헤더에 있는 컨트롤 비트이다.

최초의 패킷은 TCP 컨트롤 비트의 SYN 비트가 1이 되고, ACK 비트가 0이 된다.
송신처 IP 주소가 웹 서버이고, 포트번호가 80번이고, 컨트롤 비트의 SYN 비트가 1이면서, ACK 비트가 0인 패킷을 막으면
웹 서버에서 인터넷측에 액세스 하는 동작을 막을 수 있다.

이렇게 해서 허용 할 패킷을 지정하고, 그 외에는 모두 차단하도록 조건을 설정한다.
모두 차단하는 이유는 필요한 것만 선별하여 통과시켜 미지의 위험을 막기 위해서이고, 이것이 일반적이다.

## 사내 LAN에서 공개 서버용 LAN으로 조건 설정

인터넷, 공개 서버용 LAN을 왕래하는 패킷 뿐만 아니라, 사내 LAN과 공개 서버용 LAN을 왕래하는 패킷의 조건도 설정해야 하는데
이 때 조건이 서로 악영향을 끼치지 않도록 주의해야 한다.

## 밖에서 사내 LAN으로 액세스 불가

패킷 필터링형 방화벽은 패킷을 통과시킬지 차단시킬지를 판단할 뿐만 아니라 주소 변환의 기능도 가지고 있어, 설정이 필요하다.

즉, 인터넷과 사내 LAN을 왕래하는 패킷은 주소 변환을 해야 하기 때문에 설정이 필요한 것인데,
구체적으로는 필터링과 마찬가지로 패킷의 시점, 종점을 조건으로 지정한 후 주소 변환이 필요한 경우에만 변환을 하고,
나머지는 변환하지 않도록 설정한다.

