# 서버

## 클라이언트와 서버의 차이점

클러이언트와 서버는 네트워크 관점에서는 같지만, 하드웨어나 OS 영역은 다르다.

물론 네트워크 관점이 같다고 해서 모든 것이 같은 것은 아니다.
LAN 어댑터, 프로토콜 스택, Socker 라이브러리 등의 기능이 같아도 사용하는 방법까지 동일하지는 않은데,
접속 동작을 할 때 클라이언트에서 접속 동작을 수행하고 서버는 그 것을 기다리는 형태가 되므로 Socket 라이브러리의 사용법이 달라진다.

## 서버 애플리케이션의 구조

서버는 복수의 클라이언트와 동시에 동작을 실행하지만, 하나의 프로그램으로 여러 클라이언트들을 상대하는 것은 어렵다.
때문에 클라이언트가 접속할 때마다 새로 서버 프로그램을 작동하여 서버 애플리케이션과 클라이언트가 1:1로 대화하는 방법을 선택하는 것이 일반적이다.

먼저 서버 프로그램의 접속을 기다리는 부분과 클라이언트와 대화하는 부분, 둘로 나누어 서버 프로그램을 만든다.
그 후 서버 프로그램을 작동하여 설정 파일 읽기 등과 같은 초기화 동작을 마쳤을 때, 접속을 기다리는 부분을 실행한다.
그러면 해당 부분이 소켓을 작성하고 소켓을 클라이언트에서의 접속 동작을 기다리는 상태로 만든 채 쉬는 상태가 되는데,
그 이후 클라이언트가 접속했을 때 다시 작동하여 접속을 기다리고, 클라이언트와 대화하는 부분을 작동시켜 해당 부분에 접속이 끝난 소켓을 건내준다.
이러한 동작을 계속하면 클라이언트와 대화하는 부분은 접속이 끝난 소켓을 사용하여 클라이언트와 대화하기 시작한다.
대화가 끝나면 연결을 끊고 종료된다.

## 서버 측의 소켓과 포트 번호 

클라이언트의 데이터 송/수신 동작의 단계는 다음과 같다.

- 소켓을 만든다. (소켓 작성 단계)
- 서버측의 소켓과 파이프로 연결한다. (접속 단계)
- 데이터를 송/수신 한다. (송/수신 단계)
- 파이프를 분리하고 소켓을 말소한다. (연결 끊기 단계)

서버측의 데이터 송/수신 동작의 단계는 다음과 같다.

- 소켓을 만든다. (소켓 작성 단계)
- 소켓을 접속 대기 상태로 만든다. (접속 대기 상태)
- 접속을 접수한다. (접속 접수 단계)
- 데이터를 송/수신 한다. (송/수신 단계)
- 파이프를 분리하고 소켓을 말소한다. (연결 끊기 단계)

서버측에서 Socket 라이브러리를 사용하는 구체적인 동작은 다음과 같다.

먼저 socket을 호출하여 소켓을 만들고, bind를 호출하여 소켓에 포트 번호를 기록한다.
그 후 listen을 호출하여 소켓에 접속하기를 기다리는 상태라는 제어 정보를 기록하여
클라이언트에서 접속 동작의 패킷이 도착하는 것을 기다리는 상태가 되고, accept를 호출하여 접속을 접수한다.
이상태에서 접속 패킷이 도착하면 응답 패킷을 반송하여 접속 접수 동작을 실행한다.
그리고 접속 대기의 소켓을 복사해 새로운 소켓을 만들고,
접속 상대의 정보를 비롯한 제어 정보를 새 소켓에 기록한다.
그 이후의 과정은 데이터 송/수신 동작으로 클라이언트와 동일하다.

